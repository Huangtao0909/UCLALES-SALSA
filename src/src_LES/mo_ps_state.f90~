MODULE mo_ps_state
  USE classFieldArray
  USE mo_structured_datatypes
  USE mo_ps_procedures
  IMPLICIT NONE

  TYPE(FloatArray1d), TARGET :: ps_theta, ps_temp, ps_press,     &
                                ps_rp, ps_rc, ps_rr, ps_ri,      &
                                ps_riri, ps_Naa, ps_Nab,         &
                                ps_Nca, ps_Ncb, ps_Np, ps_Ni,    &
                                ps_RH, ps_rsl, ps_RHI, ps_rsi,   &

                                ps_rrate, ps_irate,              &

                                ps_rflx, ps_sflx, ps_lwup,       &
                                ps_lwdn, ps_swup, ps_swdn,       &

                                ps_Dwaa, ps_Dwab, ps_Dwca,       &
                                ps_Dwcb, ps_Dwpa, ps_Dwia,       &

                                ps_aSO4a, ps_aSO4b, ps_cSO4a, ps_cSO4b, ps_pSO4a, ps_iSO4a,  &
                                ps_aOCa, ps_aOCb, ps_cOCa, ps_cOCb, ps_pOCa, ps_iOCa,  &
                                ps_aBCa, ps_aBCb, ps_cBCa, ps_cBCb, ps_pBCa, ps_iBCa,  &
                                ps_aDUa, ps_aDUb, ps_cDUa, ps_cDUb, ps_pDUa, ps_iDUa,  &
                                ps_aSSa, ps_aSSb, ps_cSSa, ps_cSSb, ps_pSSa, ps_iSSa,  &
                                ps_aNOa, ps_aNOb, ps_cNOa, ps_cNOb, ps_pNOa, ps_iNOa,  &
                                ps_aNHa, ps_aNHb, ps_cNHa, ps_cNHb, ps_pNHa, ps_iNHa

                                
  REAL, ALLOCATABLE, TARGET :: zeros1d(:)

  CONTAINS

    SUBROUTINE setPSVariables(PS,outputlist,level,nzp)
      TYPE(FieldArray), INTENT(inout) :: PS
      CHARACTER(len=10), INTENT(in)   :: outputlist(:)
      INTEGER, INTENT(in)             :: nzp,level
      CLASS(*), POINTER :: pipeline
      
      ALLOCATE(zeros1d(nzp))

      IF (ANY(outputlist == "theta")) THEN
         ps_theta = FloatArray1d(zeros1d,store=.FALSE.)
         ps_theta%onDemand => globalAvgProfile
         pipeline => ps_theta
         CALL PS%newField("theta", "Potential temperature", "K", "ztt",   &
                          ANY(outputlist == "theta"), pipeline)
      END IF

      IF (ANY(outputlist == "temp")) THEN
         ps_temp = FloatArray1d(zeros1d,store=.FALSE.)
         ps_temp => globalAvgProfile
         pipeline => ps_temp
         CALL PS%newField("temp", "Abs temperature", "K", "ztt",   &
                          ANY(outputlist == "temp"), pipeline)
      END IF

      IF (ANY(outputlist == "press")) THEN
         ps_press = FloatArray1d(zeros1d,store=.FALSE.)
         ps_press => globalAvgProfile
         pipeline => ps_press
         CALL PS%newField("press", "Pressure", "Pa", "ztt",   &
                          ANY(outputlist == "press"), pipeline)
      END IF

      IF (ANY(outputlist == "rp")) THEN
         ps_rp = FloatArray1d(zeros1d,store=.FALSE.)
         ps_rp => globalAvgProfile
         pipeline => ps_rp
         CALL PS%newField("rp", "Water vapor mixing ratio", "kg/kg", "ztt",   &
                          ANY(outputlist == "rp"), pipeline)
      END IF

      IF (ANY(outputlist == "rc")) THEN
         ps_rc = FloatArray1d(zeros1d,store=.FALSE.)
         ps_rc => globalAvgProfile
         pipeline => ps_rc
         CALL PS%newField("rc", "Cloud water mixing ratio", "kg/kg", "ztt",   &
                          ANY(outputlist == "rc"), pipeline)
      END IF

      IF (ANY(outputlist == "rr")) THEN
         ps_rr = FloatArray1d(zeros1d,store=.FALSE.)
         ps_rr => globalAvgProfile
         pipeline => ps_rr
         CALL PS%newField("rr", "Precipitation mixing ratio", "kg/kg", "ztt",   &
                          ANY(outputlist == "rr"), pipeline)
      END IF
         
      IF (level == 5) THEN
         IF (ANY(outputlist == "ri")) THEN
            ps_ri = FloatArray1d(zeros1d,store=.FALSE.)
            ps_ri => globalAvgProfile
            pipeline => ps_ri
            CALL PS%newField("ri", "Unrimed ice mixing ratio", "kg/kg", "ztt",   &
                             ANY(outputlist == "ri"), pipeline)
         END IF

         IF (ANY(outputlist == "riri")) THEN
            ps_riri = FloatArray1d(zeros1d,store=.FALSE.)
            ps_riri => globalAvgProfile
            pipeline => ps_riri
            CALL PS%newField("riri", "Rimed ice mixing ratio", "kg/kg", "ztt",   &
                             ANY(outputlist == "riri"), pipeline)
         END IF
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "Naa")) THEN
            ps_Naa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Naa => globalAvgProfile
            pipeline => ps_Naa
            CALL PS%newField("Naa", "Aerosol A, bulk number concentration", "m-3", "ztt",   &
                             ANY(outputlist == "Naa"), pipeline)
         END IF

         IF (ANY(outputlist == "Nab")) THEN
            ps_Nab = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Nab => globalAvgProfile
            pipeline => ps_Nab
            CALL PS%newField("Nab", "Aerosol B, bulk number concentration", "m-3", "ztt",   &
                             ANY(outputlist == "Nab"), pipeline)
         END IF

         IF (ANY(outputlist == "Nca")) THEN
            ps_Nca = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Nca => globalAvgProfile
            pipeline => ps_Nca
            CALL PS%newField("Nca", "Cloud A, bulk number concentration", "m-3", "ztt",   &
                             ANY(outputlist == "Nca"), pipeline)
         END IF

         IF (ANY(outputlist == "Ncb")) THEN
            ps_Ncb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Ncb => globalAvgProfile
            pipeline => ps_Ncb
            CALL PS%newField("Ncb", "Cloud B, bulk number concentration", "m-3", "ztt",   &
                             ANY(outputlist == "Ncb"), pipeline)
         END IF

         IF (ANY(outputlist == "Np")) THEN
            ps_Np = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Np => globalAvgProfile
            pipeline => ps_Np
            CALL PS%newField("Np", "Precipitation bulk number concentration", "m-3", "ztt",   &
                             ANY(outputlist == "Np"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "Ni")) THEN
         ps_Ni = FloatArray1d(zeros1d,store=.FALSE.)
         ps_Ni => globalAvgProfile
         pipeline => ps_Ni
         CALL PS%newField("Ni", "Ice bulk number concentration", "m-3", "ztt",   &
                          ANY(outputlist == "Ni"), pipeline)
      END IF

      IF (ANY(outputlist == "RH")) THEN
         ps_RH = FloatArray1d(zeros1d,store=.FALSE.)
         ps_RH => globalAvgProfile
         pipeline => ps_RH
         CALL PS%newField("RH", "Relative humidity", "1", "ztt",   &
                          ANY(outputlist == "RH"), pipeline)
      END IF

      IF (ANY(outputlist == "rsl")) THEN
         ps_rsl = FloatArray1d(zeros1d,store=.FALSE.)
         ps_rsl => globalAvgProfile
         pipeline => ps_rsl
         CALL PS%newField("rsl", "Saturation mixing ratio, liquid", "kg/kg", "ztt",   &
                          ANY(outputlist == "rsl"), pipeline)
      END IF
         
      IF (level == 5) THEN
         IF (ANY(outputlist == "RHI")) THEN
            ps_RHI = FloatArray1d(zeros1d,store=.FALSE.)
            ps_RHI => globalAvgProfile
            pipeline => ps_RHI
            CALL PS%newField("RHI", "Relative humidity over ice", "1", "ztt",   &
                             ANY(outputlist == "RHI"), pipeline)
         END IF

         IF (ANY(outputlist == "rsi")) THEN
            ps_rsi = FloatArray1d(zeros1d,store=.FALSE.)
            ps_rsi => globalAvgProfile
            pipeline => ps_rsi
            CALL PS%newField("rsi", "Saturation mixing ratio, ice", "kg/kg", "ztt",   &
                             ANY(outputlist == "rsi"), pipeline)
         END IF         
      END IF

      IF (ANY(outputlist == "rrate")) THEN
         ps_rrate  = FloatArray1d(zeros1d,store=.FALSE.)
         ps_rrate => globalAvgProfile
         pipeline => ps_rrate
         CALL PS%newField("rrate", "Precipitation flux", "kg/m2s", "ztt",   &
                          ANY(outputlist == "rrate"), pipeline)
      END IF
         
      IF (level == 5 .AND. ANY(outputlist == irate)) THEN
         ps_irate = FloatArray1d(zeros1d,store=.FALSE.)
         ps_irate => globalAvgProfile
         pipeline => ps_irate
         CALL PS%newField("irate", "Ice precipitation flux", "kg/m2s", "ztt",   &
                          ANY(outputlist == "irate"), pipeline)
      END IF

      IF (ANY(outputlist == "rflx")) THEN
         ps_rflx = FloatArray1d(zeros1d,store=.FALSE.)
         ps_rflx => globalAvgProfile
         pipeline => ps_rflx
         CALL PS%newField("rflx", "Net LW flux", "W/m2", "ztt",   &
                          ANY(outputlist == "rflx"), pipeline)
      END IF

      IF (ANY(outputlist == "sflx")) THEN         
         ps_sflx = FloatArray1d(zeros1d,store=.FALSE.)
         ps_sflx => globalAvgProfile
         pipeline => ps_sflx
         CALL PS%newField("sflx", "Net SW flux", "W/m2", "ztt",   &
                          ANY(outputlist == "sflx"), pipeline)
      END IF

      IF (ANY(outputlist == "lwup")) THEN
         ps_lwup = FloatArray1d(zeros1d,store=.FALSE.)
         ps_lwup => globalAvgProfile
         pipeline => ps_lwup
         CALL PS%newField("lwup", "Upward LW flux", "W/m2", "ztt",   &
                          ANY(outputlist == "lwup"), pipeline)
      END IF

      IF (ANY(outputlist == "lwdn")) THEN
         ps_lwdn = FloatArray1d(zeros1d,store=.FALSE.)
         ps_lwdn => globalAvgProfile
         pipeline => ps_lwdn
         CALL PS%newField("lwdn", "Downward LW flux", "W/m2", "ztt",   &
                          ANY(outputlist == "lwdn"), pipeline)
      END IF

      IF (ANY(outputlist == "swup")) THEN
         ps_swup = FloatArray1d(zeros1d,store=.FALSE.)
         ps_swup => globalAvgProfile
         pipeline => ps_swup
         CALL PS%newField("swup", "Upward SW flux", "W/m2", "ztt",   &
                          ANY(outputlist == "swup"), pipeline)
      END IF

      IF (ANY(outputlist == "swdn")) THEN
         ps_swdn = FloatArray1d(zeros1d,store=.FALSE.)
         ps_swdn => globalAvgProfile
         pipeline => ps_swdn
         CALL PS%newField("swdn", "Downward SW flux", "W/m2", "ztt",   &
                          ANY(outputlist == "swdn"), pipeline)
      END IF
         
      IF (level >= 4) THEN
         IF (ANY(outputlist == "Dwaa")) THEN
            ps_Dwaa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Dwaa => globalAvgProfile
            pipeline => ps_Dwaa
            CALL PS%newField("Dwaa", "Aerosol A bulk wet diameter", "m", "ztt",   &
                             ANY(outputlist == "Dwaa"), pipeline)
         END IF

         IF (ANY(outputlist == "Dwab")) THEN
            ps_Dwab = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Dwab => globalAvgProfile
            pipeline => ps_Dwab
            CALL PS%newField("Dwab", "Aerosol B bulk wet diameter", "m", "ztt",   &
                             ANY(outputlist == "Dwab"), pipeline)
         END IF

         IF (ANY(outputlist == "Dwca")) THEN
            ps_Dwca = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Dwca => globalAvgProfile
            pipeline => ps_Dwca
            CALL PS%newField("Dwca", "Cloud A bulk wet diameter", "m", "ztt",   &
                             ANY(outputlist == "Dwca"), pipeline)
         END IF

         IF (ANY(outputlist == "Dwcb")) THEN
            ps_Dwcb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Dwcb => globalAvgProfile
            pipeline => ps_Dwcb
            CALL PS%newField("Dwcb", "Cloud B bulk wet diameter", "m", "ztt",   &
                             ANY(outputlist == "Dwcb"), pipeline)
         END IF

         IF (ANY(outputlist == "Dwpa")) THEN
            ps_Dwpa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_Dwpa => globalAvgProfile
            pipeline => ps_Dwpa
            CALL PS%newField("Dwpa", "Precipitation bulk wet diameter", "m", "ztt",   &
                             ANY(outputlist == "Dwpa"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "Dwia")) THEN
         ps_Dwia = FloatArray1d(zeros1d,store=.FALSE.)
         ps_Dwia => globalAvgProfile
         pipeline => ps_Dwia
         CALL PS%newField("Dwia", "Ice bulk wet diameter (spherical)", "m", "ztt",   &
                          ANY(outputlist == "Dwia"), pipeline)
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "aSO4a")) THEN
            ps_aSO4a = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aSO4a => globalAvgProfile
            pipeline => ps_aSO4a
            CALL PS%newField("aSO4a", "Aerosol A bulk SO4 mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aSO4a"), pipeline)
         END IF

         IF (ANY(outputlist == "aSO4b")) THEN
            ps_aSO4b = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aSO4b => globalAvgProfile
            pipeline => ps_aSO4b
            CALL PS%newField("aSO4b", "Aerosol B bulk SO4 mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aSO4b"), pipeline)
         END IF

         IF (ANY(outputlist == "cSO4a")) THEN
            ps_cSO4a = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cSO4a => globalAvgProfile
            pipeline => ps_cSO4a
            CALL PS%newField("cSO4a", "Cloud A bulk SO4 mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cSO4a"), pipeline)
         END IF

         IF (ANY(outputlist == "cSO4b")) THEN
            ps_cSO4b = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cSO4b => globalAvgProfile
            pipeline => ps_cSO4b
            CALL PS%newField("cSO4b", "Cloud B bulk SO4 mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cSO4b"), pipeline)
         END IF

         IF (ANY(outputlist == "pSO4a")) THEN
            ps_pSO4a = FloatArray1d(zeros1d,store=.FALSE.)
            ps_pSO4a => globalAvgProfile
            pipeline => ps_pSO4a
            CALL PS%newField("pSO4a", "Precipitation bulk SO4 mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "pSO4a"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "iSO4a")) THEN
         ps_iSO4a = FloatArray1d(zeros1d,store=.FALSE.)
         ps_iSO4a => globalAvgProfile
         pipeline => ps_iSO4a
         CALL PS%newField("iSO4a", "Ice bulk SO4 mass", "kg/kg", "ztt",   &
                          ANY(outputlist == "iSO4a"), pipeline)
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "aOCa")) THEN
            ps_aOCa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aOCa => globalAvgProfile
            pipeline => ps_aOCa
            CALL PS%newField("aOCa", "Aerosol A bulk OC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aOCa"), pipeline)
         END IF

         IF (ANY(outputlist == "aOCb")) THEN
            ps_aOCb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aOCb => globalAvgProfile
            pipeline => ps_aOCb
            CALL PS%newField("aOCb", "Aerosol B bulk OC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aOCb"), pipeline)
         END IF

         IF (ANY(outputlist == "cOCa")) THEN
            ps_cOCa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cOCa => globalAvgProfile
            pipeline => ps_cOCa
            CALL PS%newField("cOCa", "Cloud A bulk OC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cOCa"), pipeline)
         END IF

         IF (ANY(outputlist == "cOCb")) THEN
            ps_cOCb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cOCb => globalAvgProfile
            pipeline => ps_cOCb
            CALL PS%newField("cOCb", "Cloud B bulk OC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cOCb"), pipeline)
         END IF

         IF (ANY(outputlist == "pOCa")) THEN
            ps_pOCa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_pOCa => globalAvgProfile
            pipeline => ps_pOCa
            CALL PS%newField("pOCa", "Precipitation bulk OC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "pOCa"), pipeline)
         END IF
      END IF
         
      IF (level == 5 .AND. ANY(outputlist == "iOCa")) THEN
         ps_iOCa = FloatArray1d(zeros1d,store=.FALSE.)
         ps_iOCa => globalAvgProfile
         pipeline => ps_iOCa
         CALL PS%newField("iOCa", "Ice bulk OC mass", "kg/kg", "ztt",   &
                          ANY(outputlist == "iOCa"), pipeline)
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "aBCa")) THEN
            ps_aBCa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aBCa => globalAvgProfile
            pipeline => ps_aBCa
            CALL PS%newField("aBCa", "Aerosol A bulk BC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aBCa"), pipeline)
         END IF
         
         IF (ANY(outputlist == "aBCb")) THEN
            ps_aBCb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aBCb => globalAvgProfile
            pipeline => ps_aBCb
            CALL PS%newField("aBCb", "Aerosol B bulk BC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aBCb"), pipeline)
         END IF

         IF (ANY(outputlist == "cBCa")) THEN
            ps_cBCa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cBCa => globalAvgProfile
            pipeline => ps_cBCa
            CALL PS%newField("cBCa", "Cloud A bulk BC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cBCa"), pipeline)
         END IF

         IF (ANY(outputlist == "cBCb")) THEN
            ps_cBCb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cBCb => globalAvgProfile
            pipeline => ps_cBCb
            CALL PS%newField("cBCb", "Cloud B bulk BC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cBCb"), pipeline)
         END IF

         IF (ANY(outputlist == "pBCa")) THEN
            ps_pBCa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_pBCa => globalAvgProfile
            pipeline => ps_pBCa
            CALL PS%newField("pBCa", "Precipitation bulk BC mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "pBCa"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "iBCa")) THEN
         ps_iBCa = FloatArray1d(zeros1d,store=.FALSE.)
         ps_iBCa => globalAvgProfile
         pipeline => ps_iBCa
         CALL PS%newField("iBCa", "Ice bulk BC mass", "kg/kg", "ztt",   &
                          ANY(outputlist == "iBCa"), pipeline)
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "aDUa")) THEN
            ps_aDUa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aDUa => globalAvgProfile
            pipeline => ps_aDUa
            CALL PS%newField("aDUa", "Aerosol A bulk DU mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aDUa"), pipeline)
         END IF

         IF (ANY(outputlist == "aDUb")) THEN
            ps_aDUb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aDUb => globalAvgProfile
            pipeline => ps_aDUb
            CALL PS%newField("aDUb", "Aerosol B bulk DU ", "kg/kg", "ztt",   &
                             ANY(outputlist == "aDUb"), pipeline)
         END IF

         IF (ANY(outputlist == "cDUa")) THEN
            ps_cDUa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cDUa => globalAvgProfile
            pipeline => ps_cDUa
            CALL PS%newField("cDUa", "Cloud A bulk DU mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cDUa"), pipeline)
         END IF

         IF (ANY(outputlist == "cDUb")) THEN
            ps_cDUb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cDUb => globalAvgProfile
            pipeline => ps_cDUb
            CALL PS%newField("cDUb", "Cloud B bulk DU mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cDUb"), pipeline)
         END IF

         IF (ANY(outputlist == "pDUa")) THEN
            ps_pDUa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_pDUa => globalAvgProfile
            pipeline => ps_pDUa
            CALL PS%newField("pDUa", "Precipitation bulk DU mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "pDUa"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "iDUa")) THEN
         ps_iDUa = FloatArray1d(zeros1d,store=.FALSE.)
         ps_iDUa => globalAvgProfile
         pipeline => ps_iDUa
         CALL PS%newField("iDUa", "Ice bulk DU mass", "kg/kg", "ztt",   &
                          ANY(outputlist == "iDUa"), pipeline)
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "aSSa")) THEN
            ps_aSSa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aSSa => globalAvgProfile
            pipeline => ps_aSSA
            CALL PS%newField("aSSA", "Aerosol A bulk SS mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aSSa"), pipeline)
         END IF

         IF (ANY(outputlist == "aSSb")) THEN
            ps_aSSb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aSSb => globalAvgProfile
            pipeline => ps_aSSb
            CALL PS%newField("aSSb", "Aerosol B bulk SS mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aSSb"), pipeline)
         END IF

         IF (ANY(outputlist == "cSSa")) THEN
            ps_cSSa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cSSa => globalAvgProfile
            pipeline => ps_cSSa
            CALL PS%newField("cSSa", "Cloud A bulk SS mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cSSa"), pipeline)
         END IF

         IF (ANY(outputlist == "cSSb")) THEN
            ps_cSSb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cSSb => globalAvgProfile
            pipeline => ps_cSSb
            CALL PS%newField("cSSb", "Cloud B bulk SS mass", "K", "ztt",   &
                             ANY(outputlist == "cSSb"), pipeline)
         END IF

         IF (ANY(outputlist == "pSSa")) THEN
            ps_pSSa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_pSSa => globalAvgProfile
            pipeline => ps_pSSa
            CALL PS%newField("pSSa", "Precipitation bulk SS mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "pSSa"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "iSSa")) THEN
         ps_iSSa = FloatArray1d(zeros1d,store=.FALSE.)
         ps_iSSa => globalAvgProfile
         pipeline => ps_iSSa
         CALL PS%newField("iSSa", "Ice bulk SS mass", "kg/kg", "ztt",   &
                          ANY(outputlist == "iSSa"), pipeline)
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "aNOa")) THEN
            ps_aNOa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aNOa => globalAvgProfile
            pipeline => ps_aNOa
            CALL PS%newField("aNOa", "Aerosol A bulk NO mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aNOa"), pipeline)
         END IF

         IF (ANY(outputlist == "aNOb")) THEN
            ps_aNOb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aNOb => globalAvgProfile
            pipeline => ps_aNOb
            CALL PS%newField("aNOb", "Aerosol B bulk NO mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aNOb"), pipeline)
         END IF

         IF (ANY(outputlist == "cNOa")) THEN
            ps_cNOa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cNOa => globalAvgProfile
            pipeline => ps_cNOa
            CALL PS%newField("cNOa", "Cloud A bulk NO mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cNOa"), pipeline)
         END IF
            
         IF (ANY(outputlist == "cNOb")) THEN
            ps_cNOb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cNOb => globalAvgProfile
            pipeline => ps_cNOb
            CALL PS%newField("cNOb", "Cloud B bulk NO mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cNOb"), pipeline)
         END IF
            
         IF (ANY(outputlist == "pNOa")) THEN
            ps_pNOa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_pNOa => globalAvgProfile
            pipeline => ps_pNOa
            CALL PS%newField("pNOa", "Precipitation bulk NO mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "pNOa"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "iNOa")) THEN
         ps_iNOa = FloatArray1d(zeros1d,store=.FALSE.)
         ps_iNOa => globalAvgProfile
         pipeline => ps_iNOa
         CALL PS%newField("iNOa", "Ice bulk NO mass", "kg/kg", "ztt",   &
                          ANY(outputlist == "iNOa"), pipeline)
      END IF

      IF (level >= 4) THEN
         IF (ANY(outputlist == "aNHa")) THEN
            ps_aNHa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aNHa => globalAvgProfile
            pipeline => ps_aNHa
            CALL PS%newField("aNHa", "Aerosol A bulk NH mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aNHa"), pipeline)
         END IF
            
         IF (ANY(outputlist == "aNHb")) THEN
            ps_aNHb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_aNHb => globalAvgProfile
            pipeline => ps_aNHb
            CALL PS%newField("aNHb", "Aerosol B bulk NH mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "aNHb"), pipeline)
         END IF
            
         IF (ANY(outputlist == "cNHa")) THEN
            ps_cNHa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cNHa => globalAvgProfile
            pipeline => ps_cNHa
            CALL PS%newField("cNHa", "Cloud A bulk NH mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cNHa"), pipeline)
         END IF
            
         IF (ANY(outputlist == "cNHb")) THEN
            ps_cNHb = FloatArray1d(zeros1d,store=.FALSE.)
            ps_cNHb => globalAvgProfile
            pipeline => ps_cNHb
            CALL PS%newField("cNHb", "Cloud B bulk NH mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "cNHb"), pipeline)
         END IF
            
         IF (ANY(outputlist == "pNHa")) THEN
            ps_pNHa = FloatArray1d(zeros1d,store=.FALSE.)
            ps_pNHa => globalAvgProfile
            pipeline => ps_pNHa
            CALL PS%newField("pNHa", "Precipitation bulk NH mass", "kg/kg", "ztt",   &
                             ANY(outputlist == "pNHa"), pipeline)
         END IF
      END IF

      IF (level == 5 .AND. ANY(outputlist == "iNHa")) THEN
         ps_iNHa = FloatArray1d(zeros1d,store=.FALSE.)
         ps_iNHa => globalAvgProfile
         pipeline => ps_iNHa
         CALL PS%newField("iNHa", "Ice bulk NH mass", "kg/kg", "ztt",   &
                          ANY(outputlist == "iNHa"), pipeline)
      END IF
      
    END SUBROUTINE setPSVariables


END MODULE mo_ps_state
